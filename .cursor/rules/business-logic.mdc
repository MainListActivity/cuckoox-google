---
description: 
globs: 
alwaysApply: false
---
# 业务逻辑规范

## 用户认证与授权

### 登录方式

1. **GitHub OIDC 登录（默认模式）**
   - 通过后端Quarkus OIDC服务进行GitHub授权登录
   - 登录成功后按优先级选择案件：URL参数 > 历史记录 > 自动选择 > 手动选择

2. **SurrealDB直接登录（管理员模式）**
   - URL包含 `admin=true` 参数时启用
   - 使用预设用户名密码直接登录SurrealDB
   - 主要供admin账号使用

### 案件选择逻辑

- **URL参数优先**: `case=案件ID` 参数具有最高优先级
- **权限校验**: 必须验证用户对指定案件的访问权限
- **历史记录**: 从SurrealDB中获取用户最后选择的案件
- **自动选择**: 用户仅参与一个案件时自动选择
- **手动选择**: 多案件情况下引导用户到案件管理页面选择

## 案件程序进程

### 状态流转

按照《中华人民共和国企业破产法》规定的流程：

```
立案 → 公告 → 债权申报 → 债权人第一次会议 → 
├─ 破产清算
└─ 裁定重整 → 提交重整计划/延迟提交重整计划 → 债权人第二次会议 → 结案
```

### 关键时间节点

1. **立案阶段**: 案件录入后创建"案件机器人"账号
2. **公告阶段**: 受理时间+25天内必须公告
3. **债权申报**: 公告时间+30天开始，公告时间+3个月截止
4. **第一次会议**: 债权申报截止+15日内
5. **重整期限**: 裁定重整时间+6个月内提交重整计划
6. **延期重整**: 最多延期3个月
7. **第二次会议**: 重整计划提交+15日内

### 系统提醒规则

- **提醒时机**: 距离截止时间3-5天开始提醒
- **提醒频率**: 每天上午10点
- **提醒方式**: 通过消息中心向关注案件机器人的用户发送卡片消息

## 权限控制

### 角色体系

- **admin**: 超级管理员，完整系统权限
- **案件负责人**: 案件管理权限
- **协办律师**: 协助案件处理
- **债权审核员**: 债权审核权限  
- **债权人**: 债权申报权限

### 菜单权限

- 用户登录并选择案件后，根据身份权限动态渲染菜单
- 菜单可见性同时受身份权限和案件程序进程控制
- 自动选中并打开用户有权访问的第一个菜单项

### 操作权限

| 操作 | 权限要求 | 案件状态限制 |
|------|----------|--------------|
| 债权人录入 | 管理员权限 | 无限制 |
| 债权申报 | 债权人身份 | 债权申报阶段 |
| 债权审核 | 审核员权限 | 债权申报阶段 |
| 在线会议 | 相关权限 | 会议阶段 |
| 发布公告 | 管理员权限 | 无限制 |
| 修改案件状态 | 管理员权限 | 无限制 |

## 数据实时同步

### SurrealDB Live Query

- 利用SurrealDB的实时消息能力
- 数据大屏实时更新
- 消息中心实时推送
- 债权申报状态实时同步

### 文件存储

- **MinIO**: 支持S3协议的文件存储
- **图片**: 直接在QuillJS编辑器中预览
- **附件**: 提供下载链接，支持多种文件格式

## 重要参考文档

- [产品说明文档-jules.md](mdc:doc/产品说明文档-jules.md) - 详细业务需求
