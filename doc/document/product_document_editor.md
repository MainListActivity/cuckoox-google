# 产品功能说明文档：增强型文档编辑器

## 1. 引言

### 1.1 产品定位
增强型文档编辑器是“破产案件全生命周期管理平台”的核心组件之一。它旨在提供一个功能强大、高度集成的在线文档编辑和协作环境，专门用于创建、编辑、审阅和管理与破产案件相关的各类文档，如立案材料、债权附件、会议纪要、内部报告、法律文书草稿等。

其关键特性在于深度集成了上下文信息展示能力，通过新增的“文档扩展区域”，用户可以在编辑文档的同时，便捷地查阅来自系统其他模块的关联信息（如案件详情、债权信息等），从而显著提升工作效率和准确性。

### 1.2 目标用户
*   案件管理人及其团队成员 (主要用户)
*   债权人 (在特定场景下，如编辑债权申报附件)
*   其他需要查阅或编辑案件相关文档的授权用户

### 1.3 设计原则
*   **上下文感知:** 编辑器应能感知并利用当前文档的上下文，通过扩展区域提供最相关的信息。
*   **高效易用:** 提供直观的编辑工具和流畅的交互体验。
*   **协作支持:** (未来规划) 支持多人实时协作和版本控制。
*   **集成性:** 与平台其他模块无缝集成，方便文档的创建、访问和管理。
*   **可扩展性:** 扩展区域的设计应允许未来方便地集成更多类型的信息源。

## 2. 核心功能

### 2.1 富文本编辑
*   基于 `QuillJS` 实现，提供全面的文本格式化选项：
    *   字体、字号、颜色、背景色
    *   加粗、斜体、下划线、删除线、上标、下标
    *   标题 (H1-H6)、正文等段落样式
    *   对齐方式 (左、中、右、两端对齐)
    *   行间距、段间距
    *   列表 (有序列表、无序列表、任务列表)
    *   缩进、引用块、代码块
*   支持插入：
    *   图片 (通过上传到 `minio` 存储，并在编辑器中直接预览)
    *   表格 (基础表格创建和编辑)
    *   超链接
    *   水平分割线
*   支持查找替换、清除格式等常用编辑功能。
*   内容自动保存或提供明显的手动保存机制。

### 2.2 文档大纲 (Outline)
*   编辑器左侧面板动态生成并显示当前文档的大纲结构。
*   大纲根据文档中的标题标签 (如 H1, H2, H3 等) 自动实时更新。
*   用户点击大纲中的条目，可以快速导航到文档中的相应章节位置。
*   大纲面板可由用户选择展开或折叠。

### 2.3 文本划线评论 (Text-Specific Underlined Comments)
*   用户可以选择文档中的任意一段文本、图片或其他内容元素。
*   通过工具栏按钮或右键快捷菜单，用户可以对选定内容添加评论。
*   **视觉标记:** 被评论的文本段落将**自动添加一条明显但不过分干扰阅读的下划线**（例如黄色波浪线或细实线下划线），以永久标记该处存在评论。当鼠标悬停或该评论在评论面板中被选中时，此标记可进一步高亮（如改变背景色）。
*   评论内容、评论者信息（姓名、头像）、评论时间戳将显示在编辑器右侧的专用评论面板中。
*   评论面板中的每条评论都清晰关联到文档中被标记的内容。点击评论面板中的评论，编辑器视图会自动滚动到并高亮显示原文中对应的已标记文本；反之，点击已标记的文本，评论面板中对应的评论也会高亮或滚动到视图。
*   支持对评论进行回复（形成讨论串）、解决（标记为已处理，可选择隐藏或存档）、编辑（仅限评论者本人）、删除（仅限评论者本人或有权限的管理员）。
*   评论面板可由用户选择展开或折叠。

### 2.4 文档扩展区域 (Document Extension Area)
这是本次增强的核心功能，旨在为用户编辑文档时提供必要的上下文参考信息。

*   **位置与布局:**
    *   位于编辑器界面的一个可独立控制的面板区域，例如在编辑器的底部或作为第三个侧边栏（可配置或根据用户习惯优化）。
    *   该面板应支持展开、折叠和调整大小（如果适用）。
*   **功能目标:**
    *   根据当前正在编辑的文档的性质或用户的选择，从平台的其他模块动态拉取并展示相关的上下文数据。
    *   这些信息通常是只读的，主要用于参考，帮助用户更准确、高效地撰写或审阅文档。
*   **内容来源与选择机制:**
    *   扩展区域内可能包含一个选择器（如标签页、下拉菜单或一组按钮），允许用户指定希望查看的信息类型。
    *   可展示的信息类型示例：
        *   **案件基本信息:** 当编辑与特定案件相关的任何文档时，可显示该案件的核心摘要信息（如案件编号、名称、当事人、当前阶段、关键日期等）。
        *   **债权申报详情:** 当编辑或审阅某项债权的附件材料时，可显示该债权的申报人信息、申报金额、债权性质、当前审核状态等。
        *   **法律法规条文:** (未来) 集成法律法规数据库，根据文档内容或用户搜索，展示相关的法律条文。
        *   **相关文档列表:** (未来) 展示与当前文档相关联的其他文档的链接。
        *   **任务列表:** (未来) 如果文档与特定任务关联，可展示相关任务信息。
*   **数据展示:**
    *   信息以简洁、清晰、易于阅读的卡片或列表形式展示。
    *   对于复杂信息，可能提供折叠/展开的交互，以节省空间。
*   **用例场景:**
    *   管理人撰写《立案审查报告》时，可在扩展区域查看该案件的“案件基本信息”。
    *   管理人审核债权人A提交的《债权证明文件》时，可在扩展区域查看“债权人A的申报详情”。
    *   团队成员起草《第一次债权人会议议程》时，可在扩展区域查看“案件关键日期”和“已确认债权人列表摘要”。

### 2.5 工具栏
*   位于主编辑区域上方，通常是固定的（sticky）。
*   包含所有核心编辑、格式化、插入、评论发起等功能的按钮和下拉菜单。
*   图标化设计，清晰直观，支持tooltip提示。

## 3. 用户界面 (UI) 与交互体验 (UX) 概念

*   **整体布局:** 倾向于采用灵活的多面板布局：
    *   **左侧:** 文档大纲面板。
    *   **中间:** 核心的富文本编辑器及其顶部工具栏。
    *   **右侧:** 评论与批注面板。
    *   **底部/可切换侧栏:** 文档扩展区域面板。
*   所有面板均应支持用户手动展开/折叠，以最大化编辑空间或信息查阅空间。
*   支持平台统一的深色/亮色模式切换，所有UI元素和编辑器本身均能良好适配。
*   操作应流畅，反馈及时。例如，添加评论、切换扩展区域内容时应有平滑的过渡和加载提示。

## 4. 集成与数据流

*   文档编辑器可作为平台内的一个独立功能模块访问（如新建空白文档）。
*   更常见的是，它会被嵌入或从其他模块（如案件详情、债权审核、会议管理）中调用，并自动加载与该模块上下文相关的文档。
*   当从特定上下文（如某个债权附件）打开文档时，文档扩展区域可智能预加载最相关的信息类型（如该债权的申报详情）。
*   文档内容（通常以Delta格式）、评论数据、版本历史（未来）等存储在 `surrealdb` 中。
*   扩展区域展示的数据通过API从 `surrealdb` 中按需查询获取。

## 5. 未来展望
*   **实时多人协作编辑:** 允许多个用户同时编辑同一文档。
*   **版本历史与恢复:** 跟踪文档的修改历史，并允许恢复到任意历史版本。
*   **模板功能:** 提供常用法律文书或报告的模板库。
*   **更智能的扩展区域:** 基于AI分析文档内容，自动推荐相关的上下文信息。
*   **提及 (@mention) 功能:** 在评论或文档中提及其他用户或案件。

详细的UI/UX设计见 `doc/document/design_document_editor.md`。
