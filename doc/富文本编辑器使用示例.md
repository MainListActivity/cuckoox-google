# 富文本编辑器使用示例

## 概述

新的富文本编辑器采用Google文档风格的UI设计，具备以下特性：

- 📝 现代化的Google文档风格界面
- 📋 悬浮的上下文信息面板
- 🖥️ 全屏编辑模式
- 🤝 实时协作编辑
- 📱 响应式设计，支持移动设备

## 基本用法

### 1. 简单文本编辑

```tsx
import { FullscreenRichTextEditor } from '@/src/components/FullscreenRichTextEditor';
import { QuillDelta } from '@/src/components/RichTextEditor';
import { useState } from 'react';

const SimpleEditor = () => {
  const [content, setContent] = useState<QuillDelta>(new Delta());

  return (
    <FullscreenRichTextEditor
      value={content}
      onChange={setContent}
      placeholder="请输入内容..."
    />
  );
};
```

### 2. 带上下文信息的编辑器

```tsx
import { FullscreenRichTextEditor } from '@/src/components/FullscreenRichTextEditor';
import { mdiAccount, mdiCalendar, mdiCurrencyUsd } from '@mdi/js';

const CaseEditor = ({ caseData }) => {
  const [content, setContent] = useState<QuillDelta>(new Delta());

  const contextInfo = {
    title: `案件 ${caseData.case_number}`,
    subtitle: caseData.case_name,
    avatar: {
      text: '案',
      color: '#1976d2'
    },
    details: [
      {
        label: '负责人',
        value: caseData.responsible_person,
        icon: mdiAccount
      },
      {
        label: '立案时间',
        value: caseData.acceptance_date,
        icon: mdiCalendar
      },
      {
        label: '案件状态',
        value: caseData.process_stage,
        icon: 'M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z'
      }
    ]
  };

  return (
    <FullscreenRichTextEditor
      value={content}
      onChange={setContent}
      contextInfo={contextInfo}
      documentId={`case-${caseData.id}`}
      userId={currentUser.id}
      userName={currentUser.name}
    />
  );
};
```

### 3. 债权申报编辑器

```tsx
const ClaimEditor = ({ claimData }) => {
  const [content, setContent] = useState<QuillDelta>(new Delta());

  const contextInfo = {
    title: `债权申报 - ${claimData.id}`,
    subtitle: '附件材料编辑',
    avatar: {
      text: '债',
      color: '#2e7d32'
    },
    details: [
      {
        label: '申报金额',
        value: claimData.totalAmount,
        icon: mdiCurrencyUsd
      },
      {
        label: '债权性质',
        value: claimData.nature,
        icon: 'M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z'
      },
      {
        label: '申报时间',
        value: new Date().toLocaleDateString('zh-CN'),
        icon: mdiCalendar
      }
    ]
  };

  return (
    <FullscreenRichTextEditor
      value={content}
      onChange={setContent}
      contextInfo={contextInfo}
      documentId={`claim-attachment-${claimData.id}`}
      userId={currentUser.id}
      userName={currentUser.name}
      onFullscreenChange={(isFullscreen) => {
        console.log('全屏状态变化:', isFullscreen);
      }}
    />
  );
};
```

### 4. 只读模式

```tsx
const ReadOnlyEditor = ({ documentContent }) => {
  return (
    <FullscreenRichTextEditor
      value={documentContent}
      readOnly={true}
      contextInfo={{
        title: '查看文档',
        subtitle: '只读模式',
        details: [
          {
            label: '最后修改',
            value: '2024-01-01 12:00:00',
            icon: mdiCalendar
          }
        ]
      }}
    />
  );
};
```

## 全屏模式集成

对于需要占满整个页面的场景，可以使用全屏模式：

```tsx
const FullscreenPage = () => {
  const [isFullscreen, setIsFullscreen] = useState(false);

  useEffect(() => {
    // 当组件挂载时，自动进入全屏模式
    setIsFullscreen(true);
  }, []);

  return (
    <div style={{ height: '100vh' }}>
      <FullscreenRichTextEditor
        value={content}
        onChange={setContent}
        initialFullscreen={isFullscreen}
        onFullscreenChange={setIsFullscreen}
        contextInfo={contextInfo}
      />
    </div>
  );
};
```

## API 参考

### FullscreenRichTextEditor Props

| 属性 | 类型 | 默认值 | 描述 |
|------|------|--------|------|
| `value` | `QuillDelta \| string` | - | 编辑器内容 |
| `onChange` | `(delta: QuillDelta) => void` | - | 内容变化回调 |
| `contextInfo` | `ContextInfo` | - | 上下文信息配置 |
| `documentId` | `string` | - | 文档ID，用于协作编辑 |
| `userId` | `string` | - | 用户ID，用于协作编辑 |
| `userName` | `string` | - | 用户名，用于协作编辑 |
| `readOnly` | `boolean` | `false` | 是否只读 |
| `placeholder` | `string` | - | 占位文本 |
| `initialFullscreen` | `boolean` | `false` | 初始是否全屏 |
| `onFullscreenChange` | `(isFullscreen: boolean) => void` | - | 全屏状态变化回调 |

### ContextInfo 类型

```tsx
interface ContextInfo {
  title: string;                    // 主标题
  subtitle?: string;                // 副标题
  details: Array<{                  // 详情列表
    label: string;                  // 标签
    value: string;                  // 值
    icon?: string;                  // MDI图标路径
  }>;
  avatar?: {                        // 头像配置
    text: string;                   // 头像文字
    color?: string;                 // 头像颜色
  };
}
```

## 样式定制

编辑器支持通过CSS变量进行样式定制：

```css
:root {
  --color-primary: #009688;
  --color-background: #f6f6f6;
  --color-surface: #ffffff;
}

/* 深色模式 */
[data-theme="dark"] {
  --color-surface: #2d2d2d;
  --color-background: #1e1e1e;
  --color-text-primary: #ffffff;
}
```

## 协作编辑

编辑器支持实时协作编辑，需要配置SurrealDB：

```tsx
// 确保SurrealDB连接正常
const collaborativeEditor = (
  <FullscreenRichTextEditor
    value={content}
    onChange={setContent}
    documentId="shared-document-123"
    userId="user-456"
    userName="张三"
    contextInfo={contextInfo}
  />
);
```

## 注意事项

1. **性能优化**：大文档建议启用分页或虚拟滚动
2. **移动端适配**：在移动设备上，上下文面板会自动隐藏
3. **协作限制**：同时编辑的用户建议不超过10人
4. **文件上传**：确保MinIO服务正常运行
5. **主题适配**：编辑器会自动适配应用的深色/亮色主题

## 最佳实践

1. **设置合适的文档ID**：使用有意义的文档标识符
2. **提供上下文信息**：帮助用户理解编辑内容的背景
3. **处理全屏状态**：在全屏模式下隐藏不必要的UI元素
4. **保存草稿**：定期保存用户输入，防止数据丢失
5. **错误处理**：妥善处理网络错误和上传失败 