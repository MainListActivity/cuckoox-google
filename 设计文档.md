# 产品形态
当前app是一个纯前端（ts+reactjs，响应式布局 兼容移动端和PC）应用，通过websocket连接`surrealdb`后端进行数据处理，登录功能由另一个quarkus服务提供；
该应用支持打包为 tarui2 的跨平台app，并且若当前用户是在app环境中需要支持消息推送到用户设备上。

破产案件用户的使用逻辑是： 立案并指定管理人后在系统录入案件信息，并录入债权人信息，录入后支持一键打印债权人通知快递单。
# 功能点
## 用户登录
用户可通过后端提供的接口（quarkus提供的oidc服务）进行github登录，登录后根据链接中是否带有案件编号（例如 cuckoox.cn/signin?case=xxx）判断是否需要选择案件，
如果没有选择过案件且用户同时参与了多个案件的情况下需要用户进入案件管理页面手动选择一个案件才能进入系统（此时需要在`surrealdb`中记录用户的最后一次选择），
如果用户此前已经选择过一个案件则直接使用上一次选择的案件，
进入系统后查询用户在当前案件下拥有的身份（预置admin账号，身份以及身份能操作的菜单元数据可由admin账号在 `身份管理中` 中配置） ；
根据用户身份和用户身份关联的菜单渲染用户能操作的菜单列表，渲染完成后自动选中并打开第一个菜单。

## 消息中心
消息中心是单独的一个入口，这里展示im聊天消息和系统提醒。

## 在线会议
该页面可以看到当前案件的会议列表和会议记录

## 债权申报数据大屏
债权申报数据大屏需关联到一个具体的案件；通过surrealdb的实时消息监控债权申报和审核的变化，包括关联当前案件的所有用户登录（根据用户身份分堆）、
用户提交债权申请、用户进行债权审核（是通过还是驳回、确认债权的金额）、用户退出登录、当前申请的债权总金额、当前已审批的债权总金额、当前待审的债权总金额
当前申请的债权总笔数、当前已审批的债权总笔数、当前待审的债权总笔数、当前申请的债权人数量 ，都需要做到合理美观的可视化。

## 债权人管理
当案件程序处于立案阶段时，用户进入系统查询用户权限有债权人管理的权限则自动进入债权人管理菜单。

## 债权申报


## 债权审核
当案件程序进入债权申报阶段时，用户进入系统发现有债权审核的权限则自动进入债权审核菜单。
### 债权列表
列表展示字段： 债权人（类别（组织/个人）、姓名、id；需根据根据债权人id聚合数据），联系人（联系人姓名、联系方式），债权编号（自动生成），主张债权（包括 债权性质、本金、利息、其他、债权总额、附件材料），
审核认定债权（包括 债权性质、本金、利息、其他、债权总额、附件材料），审核人，审核状态，审核时间；其中`附件材料`是由`quilljs`和`surrealdb`结合的实时在线编辑文档，
文档的图片存储在支持S3协议的minio上，图片在文档中直接预览， 如果是其他文件类型则支持下载到本地；

列表查询：支持输入关键字对债权进行全文检索，点击搜索按钮即可搜索

### 页面操作（在页面的工具栏）：

1. 创建债权，需输入 类别（组织/个人）、姓名、id（如果是组织则为统一社会识别码，如果是个人则为身份证号），联系人（联系人姓名、联系方式），主张债权信息（包括 债权性质、本金、利息、其他、债权总额），
点击保存后进入债权`附件材料`编辑页面。
2. 批量驳回，对选中的债权进行驳回操作

### 债权操作（针对单条数据的操作）：

审核债权，进入债权审核路由，在页面左侧固定展示主张债权信息，右侧展示申请时的附件材料，用户可对段落或文字/图片添加评论 对附件材料做出的变更自动报错，支持展示附件材料的变更记录；
点击右下角悬浮“审核”按钮弹出输入框，输入框必须填入 审核债权性质、本金、利息，审核状态（下拉选择，来源：admin账号在`审核状态`中维护），可选输入其他、附件材料，
输入完成后自动计算出债权总额并醒目提醒用户，页面下方为提交和取消按钮，点击提交提醒用户“请确认债权金额后提交”，点击取消则回到列表页面。

## 案件管理
案件管理页面需要判断用户是否有对案件的写操作权限，如果没有则只展示列表，不展示任何操作按钮。

案件程序进程：根据<中华人民共和国企业破产法>的规定进行程序流转，本系统在法院指定管理人后由管理人进行操作录入案件，
案件录入后，使用案件机器人账号根据案件状态对关注了案件机器人账号的用户进行卡片消息提醒：

| 状态       | 提示时间                  | 提示频率    | 提示                            |
|----------|-----------------------|---------|-------------------------------|
| 立案       | 受理时间+25天-当前时间<=5天     | 每天上午10点 | “距离最迟公告时间仅有x天”                |
| 公告       | 公告时间+30天-当前时间<=3      | 每天上午10点 | “距离开始债权申报时间还有x天”              |
| 债权申报     | 公告时间+3月-当前时间<=3       | 每天上午10点 | “距离债权申报截止还有x天”                |
| 债权人第一次会议 | 债权申报截止时间+15日-当前时间<=3  | 每天上午10点 | 距离第一次债权人会议截止时间还有x天            |
| 裁定重整     | 裁定重整时间+6月-当前时间<=5     | 每天上午10点 | 距离提交重整计划截止时间还有x天，超时未提交将宣告破产清算 |
| 延迟提交重整计划 | 延迟提交重整计划时间+3月-当前时间<=5 | 每天上午10点 | 距离提交重整计划截止时间还有x天，超时未提交将宣告破产清算 |
| 债权人第二次会议 | 提交重整计划时间+15日-当前时间<=3  | 每天上午10点 | 距离第二次债权人会议通知截止时间还有x天          |


变更状态为公告 即公告时间确定，

### 案件列表
列表展示字段： 案件编号，案件负责人，案件程序（默认破产），受理时间，程序进程（枚举值：立案、公告、债权申报、债权人第一次会议、裁定重整、提交重整计划、延迟提交重整计划、债权人第二次会议、破产清算、结案），创建人，立案材料（由`quilljs`和`surrealdb`结合的实时在线编辑文档可复用债权附件材料）。

用户可操作的菜单除了受身份权限管控外，还会受到案件程序进程的管控，但债权人管理页面的录入、发布公告，案件页面的修改状态操作仅受身份权限管控，如下表：

| 状态       | 允许的操作     | 其他限制                                  |
|----------|-----------|---------------------------------------|
| 债权申报     | 债权申请、债权审核 | 当用户A提交了债权，则只有当用户B驳回之后才可再次编辑，否则A只有只读权限 |
| 债权人第一次会议 | 在线会议      |                                       |
| 债权人第二次会议 | 在线会议      |                                       |


### 页面操作（在页面的工具栏）：
创建案件： 录入案件负责人，选择案件程序（默认选中破产），录入受理时间，
当案件程序是破产时需要额外录入 公告时间（可选，可清空，默认填入受理时间后25日并提示“最迟受理破产申请之日起25日”）、
债权申报开始时间（可选，可清空，如果有公告时间默认填入公告时间后30日并提示“最早发布受理破产申请公告之日30日”）、
债权申报截止时间（可选，可清空，如果有公告时间默认填入公告时间后3月并提示“最迟发布受理破产申请公告之日3个月”），创建案件后默认状态为立案

案件创建后自动在消息中心创建一个案件的机器人账号，用于发送提醒消息
### 案件操作（针对单条数据的操作）：
查看详情： 点击后进入案件详情页面，左侧固定展示案件基本信息和时间点信息，时间点使用时间轴的方式串联起来，主区域展示`立案材料`详情，详情仅查看不可编辑。

会议纪要： 债权人第一次会议和第二次会议期间可以在操作栏填写会议纪要。

修改状态，状态的修改选项依赖当前的状态，在任何一个阶段都可以操作结案，并设置结案时间；债权人第一次会议和第二次会议期间可以在操作栏填写会议纪要，其余状态按照下表逻辑处理流转状态：

| 当前状态     | 可修改为     | 修改契机                    | 处理逻辑                                           |
|----------|----------|-------------------------|------------------------------------------------|
| 立案       | 公告       | 通过平台的打印公告快递单号、在案件管理手动修改 | 更新案件公告时间                                       |
| 公告       | 债权申报     | 手动修改                    | 记录债权申报开始时间                                     |
| 债权申报     | 债权人第一次会议 | 手动修改                    | 记录 债权申报截止时间                                    |
| 债权人第一次会议 | 破产清算     | 手动修改                    | 记录债权人第一次会议时间                                   |
| 债权人第一次会议 | 裁定重整     | 手动修改                    | 记录债权人第一次会议时间，记录裁定重整时间，需在页面提交裁定重整公告（与立案材料的形式相同） |
| 裁定重整     | 提交重整计划   | 手动修改                    | 记录重整计划提交时间，需在页面提交重整计划（与立案材料的形式相同）              |
| 裁定重整     | 延迟提交重整计划 | 手动修改                    | 记录延迟提交重整计划时间                                   |
| 提交重整计划   | 债权人第二次会议 | 手动修改                    |                                                |
| 延迟提交重整计划 | 债权人第二次会议 | 手动修改                    |                                                |


# 样式与设计风格
设计风格选用Material Design的规范，最好直接使用类似于`vuetifyjs`的开源组件，`债权申报数据大屏`需要大气、美观、科技感十足的页面样式。

# 技术选型

## 前端
ts+reactjs+tailwindcss

## 后端
surrealdb 2.2.0，需要给出数据表的结构设计
